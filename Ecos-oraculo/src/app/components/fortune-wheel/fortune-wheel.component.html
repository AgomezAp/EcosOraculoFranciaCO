<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div class="crystal-ball-container" [class.active]="isVisible">
      <div class="crystal-backdrop" (click)="onWheelClosedHandler()"></div>

      <div class="crystal-modal">
        <div class="crystal-header">
          <h2>Consultez l'Oracle Cosmique</h2>
          <button class="close-crystal-btn" (click)="onWheelClosedHandler()">
            ‚úï
          </button>
        </div>

        <div class="crystal-content">
          <!-- Base ornamental -->
          <div class="crystal-base">
            <div class="base-details">
              <div class="base-ring"></div>
              <div class="base-runes">
                <span class="rune">‚à¥</span>
                <span class="rune">‚ãÑ</span>
                <span class="rune">‚à¥</span>
              </div>
            </div>
          </div>

          <!-- Bola de cristal -->
          <div class="crystal-ball-wrapper">
            <div
              class="crystal-ball"
              #crystalElement
              [class.spinning]="wheelSpinning"
              [class.revealing]="selectedPrize && !wheelSpinning"
            >
              <!-- Part√≠culas m√≠sticas flotantes -->
              <div class="mystic-particles">
                <div
                  class="particle"
                  style="--delay: 0s; --x: 20%; --y: 30%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 1s; --x: 80%; --y: 20%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 2s; --x: 30%; --y: 70%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 3s; --x: 70%; --y: 80%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 4s; --x: 50%; --y: 40%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 5s; --x: 60%; --y: 60%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 6s; --x: 40%; --y: 20%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 7s; --x: 90%; --y: 50%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 8s; --x: 10%; --y: 80%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 9s; --x: 75%; --y: 35%"
                ></div>
              </div>

              <!-- Energ√≠a m√≠stica circular -->
              <div class="mystic-energy">
                <div class="energy-ring outer-ring"></div>
                <div class="energy-ring middle-ring"></div>
                <div class="energy-ring inner-ring"></div>
              </div>

              <!-- Galaxia interior girando -->
              <div
                class="galaxy-core"
                [style.transform]="
                  'translate(-50%, -50%) rotate(' + currentRotation + 'deg)'
                "
              >
                <div class="cosmic-dust"></div>
                <div class="stellar-field"></div>
                <div class="nebula-swirl"></div>
                <div class="center-orb"></div>
              </div>

              <!-- ‚úÖ ACTUALIZADO: Elementos flotantes de los premios -->
              <div
                class="prize-elements"
                *ngIf="!wheelSpinning && !selectedPrize"
              >
                <div
                  *ngFor="let prize of prizes; let i = index"
                  class="floating-symbol"
                  [style.animation-delay]="i * 1 + 's'"
                >
                  <div class="symbol-glow">{{ prize.icon }}</div>
                </div>
              </div>

              <!-- ‚úÖ ACTUALIZADO: Resultado en el centro -->
              <div
                class="crystal-result"
                *ngIf="selectedPrize && !wheelSpinning"
              >
                <div class="result-aura">
                  <div class="result-symbol">{{ selectedPrize.icon }}</div>
                  <div class="result-title">{{ selectedPrize.name }}</div>
                </div>
              </div>

              <!-- Reflexos y brillos del cristal -->
              <div class="crystal-reflections">
                <div class="reflection primary-reflection"></div>
                <div class="reflection secondary-reflection"></div>
                <div class="reflection tertiary-reflection"></div>
              </div>

              <!-- Aura exterior -->
              <div class="crystal-aura"></div>
            </div>

            <!-- ‚úÖ ACTUALIZADO: Bot√≥n de activaci√≥n con control completo -->
            <div
              class="oracle-activation"
              [class.disabled]="
                !canSpinWheel || wheelSpinning || isProcessingClick
              "
              [class.processing]="isProcessingClick"
              (click)="spinWheel()"
            >
              <div class="activation-symbol">
                <!-- Estado normal: puede girar -->
                <div
                  *ngIf="!wheelSpinning && !isProcessingClick && canSpinWheel"
                  class="rune-circle"
                >
                  <span class="central-rune">‚óä</span>
                </div>

                <!-- Estado procesando clic -->
                <div
                  *ngIf="isProcessingClick && !wheelSpinning"
                  class="processing-click"
                >
                  <div class="click-loader"></div>
                </div>

                <!-- Estado girando -->
                <div *ngIf="wheelSpinning" class="channeling-energy">
                  <div class="energy-spiral"></div>
                </div>

                <!-- Estado bloqueado -->
                <div
                  *ngIf="!canSpinWheel && !wheelSpinning && !isProcessingClick"
                  class="disabled-rune"
                >
                  <span class="locked-rune">üîí</span>
                </div>
              </div>

              <div class="activation-label">
                <!-- Texto cuando puede girar -->
                <span
                  *ngIf="!wheelSpinning && !isProcessingClick && canSpinWheel"
                >
                  Consulter l'Oracle
                </span>

                <!-- Texto procesando -->
                <span *ngIf="isProcessingClick && !wheelSpinning">
                  Traitement...
                </span>

                <!-- Texto cuando est√° girando -->
                <span *ngIf="wheelSpinning">Canalisation des √ânergies...</span>

                <!-- Texto cuando ya us√≥ la tirada diaria -->
                <span
                  *ngIf="
                    !canSpinWheel &&
                    !wheelSpinning &&
                    !isProcessingClick &&
                    hasUsedDailyFreeSpIn &&
                    !hasFreeSpinsAvailable()
                  "
                >
                  Vous avez d√©j√† consult√© aujourd'hui
                </span>

                <!-- Texto con tiempo restante -->
                <span
                  *ngIf="
                    !canSpinWheel &&
                    !wheelSpinning &&
                    !isProcessingClick &&
                    !hasUsedDailyFreeSpIn
                  "
                >
                  Prochaine consultation dans : {{ getTimeUntilNextSpin() }}
                </span>

                <!-- Texto cuando no hay tiradas disponibles -->
                <span
                  *ngIf="
                    !canSpinWheel &&
                    !wheelSpinning &&
                    !isProcessingClick &&
                    hasUsedDailyFreeSpIn &&
                    !hasFreeSpinsAvailable()
                  "
                >
                  Aucune tirade disponible
                </span>
              </div>

              <!-- ‚úÖ ACTUALIZADO: Indicador de spins extras disponibles -->
              <div
                class="extra-spins-indicator"
                *ngIf="hasFreeSpinsAvailable()"
              >
                <span class="spins-count">
                  üé∞ {{ getWheelSpinsCount() }} tours de roue
                </span>
              </div>

              <!-- ‚úÖ NUEVO: Indicador de consultas disponibles -->
              <div
                class="dream-consultations-indicator"
                *ngIf="getDreamConsultationsCount() > 0"
              >
                <span class="consultations-count">
                  üîÆ {{ getDreamConsultationsCount() }} consultations de r√™ves
                </span>
              </div>
            </div>
          </div>

          <!-- ‚úÖ ACTUALIZADO: Informaci√≥n de estado de la ruleta -->
          <div class="wheel-status">
            <div class="status-info">
              <!-- Info cuando no est√° girando ni procesando -->
              <div
                class="spin-info"
                *ngIf="!wheelSpinning && !isProcessingClick"
              >
                <span
                  *ngIf="
                    canSpinWheel &&
                    !hasUsedDailyFreeSpIn &&
                    getWheelSpinsCount() === 0
                  "
                >
                  üéÅ Tour quotidien gratuit disponible
                </span>
                <span *ngIf="canSpinWheel && getWheelSpinsCount() > 0">
                  üé∞ {{ getWheelSpinsCount() }} tours de roue disponibles
                </span>
                <span *ngIf="!canSpinWheel && !hasFreeSpinsAvailable()">
                  ‚è∞ Aucun tour disponible jusqu'√† demain
                </span>
              </div>

              <!-- Info cuando est√° procesando -->
              <div
                class="processing-info"
                *ngIf="isProcessingClick && !wheelSpinning"
              >
                <div class="processing-animation">
                  <span class="process-icon">‚ö°</span>
                  <span class="process-text">Pr√©paration de la consultation...</span>
                </div>
              </div>

              <!-- Info cuando est√° girando -->
              <div class="spinning-info" *ngIf="wheelSpinning">
                <div class="spin-animation">
                  <span class="swirl-icon">üå™Ô∏è</span>
                  <span class="spin-text"
                    >Les √©nergies cosmiques d√©cident...</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- ‚úÖ ACTUALIZADO: Mensaje m√≠stico durante spinning -->
          <div class="cosmic-message" *ngIf="wheelSpinning">
            <div class="message-text">
              <h3>Les forces cosmiques r√©v√®lent votre destin</h3>
              <div class="cosmic-dots">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
              </div>
            </div>
          </div>

          <!-- ‚úÖ ACTUALIZADO: Resultado final -->
          <div
            class="oracle-revelation"
            *ngIf="selectedPrize && !wheelSpinning"
          >
            <div class="revelation-scroll">
              <h3>L'Oracle a Parl√©</h3>
              <div class="destiny-manifest">
                <div class="manifest-symbol">{{ selectedPrize.icon }}</div>
                <div class="manifest-text">{{ selectedPrize.name }}</div>
              </div>

              <!-- ‚úÖ ACTUALIZADO: Informaci√≥n espec√≠fica del premio -->
              <div class="prize-description" *ngIf="selectedPrize">
                <p *ngIf="selectedPrize.id === '1'">
                  üé∞ Vous avez gagn√© 3 tours suppl√©mentaires pour la roue de l'oracle
                  <br /><strong
                    >Tours disponibles : {{ getWheelSpinsCount() }}</strong
                  >
                </p>
                <p *ngIf="selectedPrize.id === '2'">
                  üîÆ Une consultation gratuite d'interpr√©tation de r√™ves vous attend
                  <br /><strong
                    >Consultations disponibles :
                    {{ getDreamConsultationsCount() }}</strong
                  >
                </p>
                <p *ngIf="selectedPrize.id === '3'">
                  üéØ 2 tours suppl√©mentaires de roue ont √©t√© ajout√©s √† votre compte
                  <br /><strong
                    >Tours disponibles : {{ getWheelSpinsCount() }}</strong
                  >
                </p>
                <p *ngIf="selectedPrize.id === '4'">
                  üîÑ Les √©nergies vous accordent un tour suppl√©mentaire imm√©diat
                  <br /><strong
                    >Tours disponibles : {{ getWheelSpinsCount() }}</strong
                  >
                </p>
              </div>

              <!-- ‚úÖ NUEVO: Botones inteligentes seg√∫n el tipo de premio -->
              <div class="prize-actions">
                <!-- ‚úÖ BOT√ìN CONTINUAR para premios que otorgan tiradas -->
                <button
                  class="continue-spinning-btn"
                  (click)="continueSpinning()"
                  *ngIf="
                    shouldShowContinueButton(selectedPrize) &&
                    getWheelSpinsCount() > 0
                  "
                >
                  <span class="continue-icon">üé≤</span>
                  Continuer √† Tourner ! ({{ getWheelSpinsCount() }} tours)
                </button>

                <!-- ‚úÖ MENSAJE cuando ganaste tiradas pero ya no tienes m√°s -->
                <div
                  class="no-more-spins-message"
                  *ngIf="
                    shouldShowContinueButton(selectedPrize) &&
                    getWheelSpinsCount() === 0
                  "
                >
                  <p>üéØ Prix r√©clam√© correctement</p>
                  <button
                    class="accept-destiny-btn"
                    (click)="onWheelClosedHandler()"
                  >
                    Fermer
                  </button>
                </div>

                <!-- ‚úÖ BOT√ìN CERRAR solo para consulta gratis -->
                <button
                  class="accept-destiny-btn"
                  (click)="onWheelClosedHandler()"
                  *ngIf="shouldShowCloseButton(selectedPrize)"
                >
                  Accepter le Destin
                </button>
              </div>

              <!-- ‚úÖ NUEVO: Estado actual de recursos -->
              <div class="current-resources" *ngIf="selectedPrize">
                <h4>üìä Ressources Actuelles :</h4>
                <div class="resource-summary">
                  <div class="resource-item">
                    <span class="resource-icon">üé∞</span>
                    <span class="resource-count">{{
                      getWheelSpinsCount()
                    }}</span>
                    <span class="resource-label">Tours de Roue</span>
                  </div>
                  <div class="resource-item">
                    <span class="resource-icon">üîÆ</span>
                    <span class="resource-count">{{
                      getDreamConsultationsCount()
                    }}</span>
                    <span class="resource-label">Consultations disponibles</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ‚úÖ NUEVO: Panel de recursos disponibles -->
          <div class="resources-panel" *ngIf="!wheelSpinning && !selectedPrize">
            <div class="resource-item" *ngIf="getWheelSpinsCount() > 0">
              <span class="resource-icon">üé∞</span>
              <span class="resource-text"
                >{{ getWheelSpinsCount() }} Tours de Roue</span
              >
            </div>
            <div class="resource-item" *ngIf="getDreamConsultationsCount() > 0">
              <span class="resource-icon">üîÆ</span>
              <span class="resource-text"
                >{{ getDreamConsultationsCount() }} Consultations disponibles</span
              >
            </div>
            <div
              class="resource-item"
              *ngIf="
                getWheelSpinsCount() === 0 &&
                getDreamConsultationsCount() === 0 &&
                canSpinWheel
              "
            >
              <span class="resource-icon">üéÅ</span>
              <span class="resource-text">Tour Quotidien Disponible</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>